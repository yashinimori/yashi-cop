<nb-card class="mainCardSingleClaim" *ngIf="!isNewRecord" status="info">
    <nb-card-header>
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>{{'single_claim_component.text1' | translate}} {{claimData.id}}</div> 
        <div style="display: flex; ">
          <div *ngIf="!isNewRecord" class="mainHeaderSingleClaimButtonsBlock">
              <button *ngIf="!isNewRecord && !fieldsStatus.button_escalation.invisible"
                style="margin-left: 10px;" 
                  nbTooltip="{{'single_claim_component.text2' | translate}}" nbTooltipStatus="primary"
                  nbTooltipTrigger="{{this.role == 'cardholder'?'hover':'noop'}}"
                  nbButton size="small" status="basic" (click)="onClickEscalation()" >{{'single_claim_component.button1' | translate}}</button>
              <button *ngIf="!isNewRecord && !fieldsStatus.button_escal_clarif.invisible"
                  nbTooltip="{{'single_claim_component.text3' | translate}}" nbTooltipStatus="primary"
                  nbTooltipTrigger="{{this.role == 'cardholder'?'hover':'noop'}}"
                  nbButton size="small" status="basic" (click)="onClickClarifications()" style="margin-left: 10px;" >{{'single_claim_component.button2' | translate}}</button>
              <button *ngIf="!isNewRecord && !fieldsStatus.button_request_docs.invisible && (claimData.status == 'Chargeback/Second Presentment запрос торговцу'
                      || claimData.status == 'Chargeback опротестование сформировано') "
                      nbButton size="small" status="basic" (click)="onClickRequestDocs()" style="margin-left: 10px;">{{'single_claim_component.button3' | translate}}
              </button>
          </div>
          <div *ngIf="!isNewRecord" class="mainHeaderSingleClaimButtonsBlock" style='padding-left: 2em;'>
            
            <button size="small" *ngIf="!isNewRecord && !fieldsStatus.button_escal_add_responce.invisible"
                nbButton status="basic"  >{{'single_claim_component.button4' | translate}}</button>
            <button *ngIf="!isNewRecord && !fieldsStatus.save_edit_claim.invisible"
                  style="margin-left: 10px;" [nbSpinner]="loadingSaveEdit" nbSpinnerStatus="info" 
                  nbButton size="small" status="success" (click)="saveClaimUpdate()">{{'single_claim_component.button5' | translate}}</button>
            <button  style="margin-left: 10px;"
                nbTooltip="{{'single_claim_component.text4' | translate}}" nbTooltipStatus="primary" nbTooltipTrigger="{{this.role == 'cardholder'?'hover':'noop'}}"
                nbButton size="small" status="basic" (click)="goBack()">{{'single_claim_component.button6' | translate}}</button>
            <button *ngIf="!isNewRecord && !fieldsStatus.button_escal_finish.invisible" style="margin-left: 10px;"
                nbTooltip="{{'single_claim_component.text5' | translate}}" nbTooltipStatus="primary"
                nbTooltipTrigger="{{this.role == 'cardholder'?'hover':'noop'}}"
                nbButton size="small" status="warning" (click)="onClickFinish()" >{{'single_claim_component.button7' | translate}}</button>
          </div>
        </div>
      </div>
     
    </nb-card-header>
</nb-card>
<ngx-chat *ngIf="!isNewRecord"></ngx-chat>

<!-- <div *ngIf="!isNewRecord" style='margin-top: -30px;padding-top: 10px; padding-bottom: 10px; display:flex'>
    <button *ngIf="!isNewRecord && !fieldsStatus.button_escalation.invisible"
        nbButton size="small" status="primary" (click)="onClickEscalation()" >Ескалація</button>
    <button *ngIf="!isNewRecord && !fieldsStatus.button_escal_clarif.invisible"
        nbButton size="small" status="primary" (click)="onClickClarifications()" style="margin-left: 10px;" >Уточненя</button>
    <button *ngIf="!isNewRecord && !fieldsStatus.button_request_docs.invisible && (claimData.status == 'Chargeback/Second Presentment запрос торговцу'
            || claimData.status == 'Chargeback опротестование сформировано') "
            nbButton size="small" status="primary" (click)="onClickRequestDocs()" style="margin-left: 10px;">Запит документів
    </button>
</div> -->

<div *ngIf="!isNewRecord && isUIloaded" class="div-panel" >
    <div class="left-panel">

        <nb-card class="cardDetails" accent="info">
            <nb-card-header>
              {{'single_claim_component.text6' | translate}}
              </nb-card-header>
            <nb-card-body>

                <div class="div-panel cardDetailsItem" *ngIf="!fieldsStatus.pan.invisible">
                  <label class="label-caption">{{'single_claim_component.text7' | translate}}</label>
                    <label class="label-data customPopover">{{claimData.pan}} <button nbButton size="tiny" style="margin-left: 1em;" 
                      nbPopover="Copied!" nbPopoverTrigger="noop" nbPopoverPlacement="right"
                      (cdkCopyToClipboardCopied)="copyEmit($event)" [cdkCopyToClipboard]="claimData.pan"><nb-icon icon="save-outline"></nb-icon></button></label>
                    
                </div>

              <div class="div-panel cardDetailsItem" *ngIf="!fieldsStatus.fio.invisible">
                <label class="label-caption">{{'single_claim_component.text8' | translate}}</label>
                <label class="label-data">{{ getUserName }}</label>
              </div>

              <div class="div-panel cardDetailsItem" *ngIf="!fieldsStatus.transDate.invisible">
                <label class="label-caption">{{'single_claim_component.text9' | translate}}</label>
                <label class="label-data">{{getDateTrans}}</label>
              </div>

              <div class="div-panel cardDetailsItem" *ngIf="!fieldsStatus.currencyName.invisible && !fieldsStatus.amount.invisible">
                <label class="label-caption">{{'single_claim_component.text10' | translate}}</label>
                <label class="label-data">{{claimData.trans_currency}} {{claimData.trans_amount}}</label>
              </div>

              <div class="div-panel cardDetailsItem" *ngIf="!fieldsStatus.merchantName.invisible">
                <label class="label-caption">{{'single_claim_component.text11' | translate}}</label>
                <label class="label-data">{{getClaimData_merch_name_ips}}</label>
              </div>

              <div class="div-panel cardDetailsItem" *ngIf="!fieldsStatus.rC.invisible">
                <label class="label-caption">{{'single_claim_component.text12' | translate}}</label>
                <label class="label-data">{{claimData.reason_code_group}}</label>
              </div>

              <div class="div-panel cardDetailsItem" *ngIf="!fieldsStatus.aRN.invisible">
                <label class="label-caption">{{'single_claim_component.text13' | translate}}</label>
                <label class="label-data">{{claimData.arn}}</label>
              </div>

              <div class="div-panel cardDetailsItem" *ngIf="!fieldsStatus.aRN_editor.invisible">
                <label class="label-caption">{{'single_claim_component.text13' | translate}}</label>
                <input class="input-data" nbInput placeholder="{{'single_claim_component.text13' | translate}}"
                       [required]="fieldsStatus.comment.required"
                       [readonly]="fieldsStatus.comment.readonly"
                       [(ngModel)]="claimData.arn"
                       minlength="23"
                       maxlength="23"
                >
              </div>

                <a href="{{getUrlPDF}}" target="_blank" >{{'single_claim_component.text14' | translate}}</a>

            </nb-card-body>

        </nb-card>
    </div>

    <div class="right-panel" *ngIf="role!='chargeback_officer'" >
        <nb-card class="cardProcess" accent="info">
            <nb-card-header>
              {{'single_claim_component.text15' | translate}}
            </nb-card-header>
            <nb-card-body>
                <div>
                  <div >
                      <label class="cardProcessLabel">{{'single_claim_component.text16' | translate}}</label>
                      <br>
                      <label class="cardProcessLabel">{{claimData.result}}</label>
                  </div>

                  <div >
                      <label class="cardProcessLabel">{{'single_claim_component.text17' | translate}}</label>
                      <br>
                    <nb-list *ngIf="comments.length != 0">
                      <nb-list-item style="padding: 0.5em;" *ngFor="let item of comments">
                        <div class="cardProcessListItem">
                          <div>{{item.user}} {{ item.create_date_str}}</div>
                          <div>{{ item.text }}</div>
                        </div>                       
                      </nb-list-item>
                    </nb-list>
                  </div>

                  <div>
                      <label class="cardProcessLabel">{{'single_claim_component.text18' | translate}}</label>
                          <!-- <a style="font-weight: bold;" *ngFor="let document of claimData.documents" href="{{document.file}}">{{document.file.split('/').pop()}}<br></a> -->
                          <br>
                          <nb-list *ngIf="documents.length != 0">
                              <nb-list-item *ngFor="let item of documents" style="font-weight: bold;">
                                  <div class="cardProcessListItem">
                                      <!-- <div>
                                          Описание: {{ item.description }}
                                      </div> -->
                                      <div>
                                          <a href="{{ item.file }}" target="_blank" >{{ item.file_name }}</a>
                                      </div>
                                  </div>
                              </nb-list-item>
                          </nb-list>
                  </div>
                </div>

            </nb-card-body>

        </nb-card>

    </div>

    <div class="right-panel" *ngIf="role=='chargeback_officer'">
        <nb-card accent="info" class="cardProcess">
            <nb-tabset fullWidth class="chargeTabset">

              <nb-tab tabTitle="{{'single_claim_component.text16' | translate}}">
                <nb-card style="width: 100%; border: 0; height: 15em;">
                  <nb-card-body>
                    <div >
                        <label class="cardProcessLabel">{{'single_claim_component.text16' | translate}}</label>
                        <br>
                        <label class="cardProcessLabel">{{claimData.result}}</label>
                    </div>

                    <div>
                        <label class="cardProcessLabel">{{'single_claim_component.text18' | translate}}</label>
                        <!-- <a style="font-weight: bold;" *ngFor="let document of claimData.documents" href="{{document.file}}">{{document.file.split('/').pop()}}<br></a> -->
                        <br>
                        <nb-list *ngIf="documents.length != 0">
                            <nb-list-item *ngFor="let item of documents" style="font-weight: bold;">
                                <div class="cardProcessListItem">
                                    <!-- <div>
                                        Описание: {{ item.description }}
                                    </div> -->
                                    <div>
                                        <a href="{{ item.file }}" target="_blank" >{{ item.file_name }}</a>
                                    </div>
                                </div>
                            </nb-list-item>
                        </nb-list>
                    </div>

                  </nb-card-body>
                </nb-card>
              </nb-tab>

              <nb-tab tabTitle="{{'single_claim_component.text19' | translate}}">

                <nb-card style="width: 100%; border: 0; height: 15em;">
                  <nb-card-body>
                    <div >
                      <label class="cardProcessLabel">{{'single_claim_component.text17' | translate}}</label>
                      <br>
                    <nb-list *ngIf="comments.length != 0">
                      <nb-list-item style="padding: 0.5em;" *ngFor="let item of comments">
                        <div class="cardProcessListItem">
                          <div>{{item.user}} {{ item.create_date_str}}</div>
                          <div>{{ item.text }}</div>
                        </div>                       
                      </nb-list-item>
                    </nb-list>
                  </div>
                  </nb-card-body>
                </nb-card>

              </nb-tab>

              <nb-tab tabTitle="{{'single_claim_component.text20' | translate}}">
                <nb-card class="editClaimTab3Card">
                  <nb-card-body>

                    <input class="input-date center tabInput" nbInput style="cursor: pointer;"
                           style="width: 100%; max-width: 35em;"
                           placeholder="{{'single_claim_component.text21' | translate}}"
                           [nbDatepicker]="formpicker_chargeback_date"
                           [(ngModel)]="claimData.chargeback_date" readonly>
                    <nb-datepicker #formpicker_chargeback_date format="dd/MM/yyyy"></nb-datepicker>

                    <input class="input-date center calendar-set tabInput" nbInput style="cursor: pointer;"
                           style="margin-top: 10px; width: 100%; max-width: 35em;"
                           placeholder="{{'single_claim_component.text22' | translate}}"
                           [nbDatepicker]="formpicker_second_presentment_date"
                           [(ngModel)]="claimData.second_presentment_date" readonly>
                    <nb-datepicker #formpicker_second_presentment_date format="dd/MM/yyyy"></nb-datepicker>

                    <input class="input-date center tabInput" nbInput style="cursor: pointer;"
                           style="margin-top: 10px; width: 100%; max-width: 35em;"
                           placeholder="{{'single_claim_component.text23' | translate}}"
                           [nbDatepicker]="formpicker_pre_arbitration_date"
                           [(ngModel)]="claimData.pre_arbitration_date" readonly>
                    <nb-datepicker #formpicker_pre_arbitration_date format="dd/MM/yyyy"></nb-datepicker>

                    <input class="input-date center tabInput" nbInput style="cursor: pointer;"
                           style="margin-top: 10px; width: 100%; max-width: 35em;"
                           placeholder="{{'single_claim_component.text24' | translate}}"
                           [nbDatepicker]="formpicker_pre_arbitration_response_date"
                           [(ngModel)]="claimData.pre_arbitration_response_date" readonly>
                    <nb-datepicker #formpicker_pre_arbitration_response_date format="dd/MM/yyyy"></nb-datepicker>

                    <input class="input-date center tabInput" nbInput style="cursor: pointer;"
                           style="margin-top: 10px; width: 100%; max-width: 35em;"
                           placeholder="{{'single_claim_component.text25' | translate}}"
                           [nbDatepicker]="formpicker_arbitration_date"
                           [(ngModel)]="claimData.arbitration_date" readonly>
                    <nb-datepicker #formpicker_arbitration_date format="dd/MM/yyyy"></nb-datepicker>

                    <input class="input-date center tabInput" nbInput style="cursor: pointer;"
                           style="margin-top: 10px; width: 100%; max-width: 35em;"
                           placeholder="{{'single_claim_component.text26' | translate}}"
                           [nbDatepicker]="formpicker_arbitration_response_date"
                           [(ngModel)]="claimData.arbitration_response_date" readonly>
                    <nb-datepicker #formpicker_arbitration_response_date format="dd/MM/yyyy"></nb-datepicker>

                  </nb-card-body>
                </nb-card>
              </nb-tab>


            </nb-tabset>
          </nb-card>

    </div>

    <!-- <a href="/api/v1/claim/3/pdf/" target="_blank" >doc</a> -->

</div>

<div  *ngIf="!isNewRecord" >
    <nb-card accent="info" class="col-12" style="min-height: 325px; height: calc(100vh - 440px); max-height: calc(100vh - 440px); padding-bottom: 1em; margin-bottom: 0;">
        <nb-card-header style="width: 100%; text-align: center; padding: 0.5em;">{{'single_claim_component.text27' | translate}}</nb-card-header>
        <nb-card-body style="padding: 0.5em 1em;">
            <div style="display: flex; flex-direction: column; width: 100%; height: 100%;">
                <div style="width: 100%; height: 100%;" *ngIf="Timeline.length != 0">
                    <!-- <nb-list-item *ngFor="let item of comments" style="font-weight: bold;">
                        {{ item.create_date_str }}
                    </nb-list-item> -->
                    <div *ngFor="let item of Timeline" class="timlineItem">
                      <div class="timlineItemTitle">
                        <div>{{ item.data.user.first_name}} {{ item.data.user.last_name}}  {{item.item_type === 'comment'?'повідомив:':'додав файли:'}}</div>
                        <div>{{getDateFormat(item.data.create_date)}}</div>
                      </div>
                      <div *ngIf="item.item_type === 'comment'" class="timlineItemText commentType">
                        <!-- {{getDateFormat(item.data.create_date)}} {{ item.data.user.first_name}} {{ item.data.user.last_name}} -->
                        {{ item.data.text }}
                      </div>
                      <div *ngIf="item.item_type === 'claimdocument'" class="timlineItemText documentType">
                        <!-- {{getDateFormat(item.data.create_date)}} {{ item.data.user.first_name}} {{ item.data.user.last_name}} -->
                         <a href="{{ item.data.file }}" target="_blank">{{ item.data.file.split('/').pop() }}</a>
                      </div>
                    </div>
                  <!-- <span>Файл: {{item.file}} </span> -->
                </div>
            </div>
        </nb-card-body>
    </nb-card>
</div>



<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->



<div *ngIf="isNewRecord && role !='merchant'" >

  <nb-card class="customCardHeight" style="width: 100%; margin: auto;">
    <nb-card-body style="padding: 0.4em 2em">
      <nb-stepper class="customStepper" orientation="horizontal" disableStepNavigation>
        <nb-step [label]="labelOne">
          <ng-template #labelOne>{{'single_claim_component.text28' | translate}}</ng-template>

          <!--  *ngIf="stepNewRecord==1" -->
          
            <nb-card class="card1CreateNewClaimStep1">        
                <nb-card-body style="padding: 0.5em;">
    
                <form #form="ngForm" ngNativeValidate>    
                
                  <div class="div-panel step1Card1Item" *ngIf="!fieldsStatus.pan.invisible">
                    <label class="label-caption">{{'single_claim_component.text29' | translate}}</label>  
                    <div style="width: 60%;">
                      <input class="input-data-valid" autocomplete="off" nbInput [(ngModel)]="claimData.pan" #pan="ngModel" name="pan" id="input-pan"  
                        placeholder="{{'single_claim_component.text29' | translate}}" pattern="^\d+$" autofocus [status]="pan.dirty ? (pan.invalid  ? 'danger' : 'success') : 'basic'"  
                        required maxlength="16" minlength="16" (keyup)="checkPanForReasonCodeCb()">
                      <ng-container *ngIf="pan.invalid && pan.touched">
                        <p class="caption status-danger danger-warning" *ngIf="pan.errors?.required">
                          {{'single_claim_component.text30' | translate}}
                        </p>
                      </ng-container>
                    </div>
                  </div>
        
                  <div class="div-panel step1Card1Item" *ngIf="!fieldsStatus.transDate.invisible">
                    <label class="label-caption">{{'single_claim_component.text31' | translate}}</label>
                    <div style="width: 60%;">
                      <input class="input-data-valid" style="cursor: pointer;" nbInput [(ngModel)]="claimData.trans_date" #trans_date="ngModel" name="trans_date" id="input-trans_date"  
                        placeholder="{{'single_claim_component.text31' | translate}}" autofocus [status]="trans_date.dirty ? (claimData.trans_date == null ? 'danger' : 'success') : 'basic'"  
                        [nbDatepicker]="formpicker" required minlength="10" maxlength="10" readonly>
                      <ng-container *ngIf="trans_date.invalid && trans_date.touched">
                        <p class="caption status-danger danger-warning" *ngIf="trans_date.errors?.required">
                          {{'single_claim_component.text32' | translate}}
                        </p>
                      </ng-container>
                      <nb-datepicker #formpicker format="dd/MM/yyyy"></nb-datepicker>
                    </div>
                  </div>
        
                  <div class="div-panel step1Card1Item" *ngIf="!fieldsStatus.merchantID.invisible">
                    <label class="label-caption">{{'single_claim_component.text33' | translate}}</label>
                    <div style="width: 60%;">      
                      <input style="width: 100%;" name="merch_id" autocomplete="off"
                        [formControl]="inputFormControlMerchUser" nbInput type="text"
                        placeholder="{{'single_claim_component.text33' | translate}}"
                        [nbAutocomplete]="auto" />
                      <nb-autocomplete #auto (selectedChange)="onSelectionChangeMerch($event)">
                        <nb-option class="step1Card1ItemOption" *ngFor="let item of filteredControlOptionsMerchUser$ | async" [value]="item">
                          {{ item }}
                        </nb-option>
                      </nb-autocomplete>
                    </div>  
                  </div>
        
                  <div class="div-panel step1Card1Item" *ngIf="!fieldsStatus.terminalID.invisible">
                    <label class="label-caption">{{'single_claim_component.text34' | translate}}</label>
                    <div style="width: 60%;">
                      <input class="input-data-valid" nbInput [(ngModel)]="claimData.term_id" #term_id="ngModel" name="term_id" id="input-term_id"  
                        placeholder="{{'single_claim_component.text34' | translate}}" autofocus [status]="term_id.dirty ? (term_id.invalid  ? 'danger' : 'success') : 'basic'"  
                        required maxlength="8" minlength="8">
                      <ng-container *ngIf="term_id.invalid && term_id.touched">
                        <p class="caption status-danger danger-warning" *ngIf="term_id.errors?.required">
                          {{'single_claim_component.text35' | translate}}
                        </p>
                      </ng-container>
                    </div>
                  </div>
        
                  <div class="div-panel step1Card1Item" *ngIf="!fieldsStatus.amount.invisible">
                    <label class="label-caption">{{'single_claim_component.text36' | translate}}</label>
                    <div style="width: 60%;">
                      <input class="input-data-valid" nbInput [(ngModel)]="claimData.trans_amount" #trans_amount="ngModel" name="trans_amount" id="input-trans_amount"  
                        placeholder="{{'single_claim_component.text36' | translate}}" autofocus [status]="trans_amount.dirty ? (trans_amount.invalid  ? 'danger' : 'success') : 'basic'"  
                        required maxlength="10" minlength="1">
                      <ng-container *ngIf="trans_amount.invalid && trans_amount.touched">
                        <p class="caption status-danger danger-warning" *ngIf="trans_amount.errors?.required">
                          {{'single_claim_component.text37' | translate}}
                        </p>
                      </ng-container>
                    </div>
                  </div>
        
                  <div class="div-panel step1Card1Item " *ngIf="!fieldsStatus.currency.invisible">
                    <label class="label-caption">{{'single_claim_component.text38' | translate}}</label>
                    <div style="width: 60%;">
                      <nb-select class="input-data-valid" [(selected)]="claimData.trans_currency" #trans_currency="ngModel" name="trans_currency" id="input-trans_currency"  
                          [(ngModel)]="claimData.trans_currency"
                          placeholder="{{'single_claim_component.text38' | translate}}" autofocus [status]="trans_currency.dirty ? (trans_currency.invalid  ? 'danger' : 'success') : 'basic'"  
                          required >
                          <nb-option *ngFor="let item of listCurrency" [value]="item.caption">
                            {{ item.caption }}
                        </nb-option>
                      </nb-select>
                        <ng-container *ngIf="trans_currency.invalid && trans_currency.touched">
                          <p class="caption status-danger danger-warning" *ngIf="trans_currency.errors?.required">
                            {{'single_claim_component.text39' | translate}}
                          </p>
                        </ng-container>
                    </div>
                  </div>
        
                  <div class="div-panel step1Card1Item" *ngIf="!fieldsStatus.authCode.invisible">
                    <label class="label-caption">{{'single_claim_component.text40' | translate}}</label>
                    <div style="width: 60%;">
                      <input style="width: 100%;" class="input-data" nbInput name="trans_approval_code"
                        placeholder="{{'single_claim_component.text40' | translate}}"
                        [required]="fieldsStatus.authCode.required"
                        [readonly]="fieldsStatus.authCode.readonly"
                        [(ngModel)]="claimData.trans_approval_code"
                        minlength="6"
                        maxlength="6"
                      >
                    </div>
                  </div>
                  <div class="div-panel step1Card1Item" *ngIf="this.role == 'chargeback_officer'">
                    <label class="label-caption">{{'single_claim_component.text41' | translate}}</label>        
                    <div style="width: 60%;">
                      <nb-select class="input-data-valid" [disabled]="!isReasonCodeInputValid" #claim_reason_code="ngModel" name="claim_reason_code" id="input-claim_reason_code"  
                          [(ngModel)]="claimData.claim_reason_code"
                          placeholder="{{'single_claim_component.text41' | translate}}" autofocus [status]="claim_reason_code.dirty ? (claim_reason_code.invalid  ? 'danger' : 'success') : 'basic'"  
                          required >
                          <nb-option class="step1Card1ItemOption" *ngFor="let code of reasonCodesArr" [value]="code.code">
                            {{ code.description }}
                        </nb-option>
                      </nb-select>
                        <ng-container *ngIf="claim_reason_code.invalid && claim_reason_code.touched">
                          <p class="caption status-danger danger-warning" *ngIf="claim_reason_code.errors?.required">
                            {{'single_claim_component.text42' | translate}}
                          </p>
                        </ng-container>
                    </div>
                  </div>
                  
                </form>
                </nb-card-body>
        
              <nb-card-footer style="padding: 0.5em;">
                <div class="center">
                  <button *ngIf="this.role != 'chargeback_officer'" nbButton size="small" nbStepperNext status="primary" [disabled]="!getCheckData" (click)="onClickGoNextStep()" >{{'single_claim_component.button8' | translate}}</button>
                  <button *ngIf="this.role == 'chargeback_officer'" nbButton size="small" nbStepperNext status="primary" [disabled]="!getCheckData" (click)="onClickGoNextStepCb()" >{{'single_claim_component.button8' | translate}}</button>  
                </div>
              </nb-card-footer>
            </nb-card>
           


        </nb-step>
        <nb-step [label]="labelTwo" *ngIf="this.role != 'chargeback_officer'">
          <ng-template #labelTwo>{{'single_claim_component.text43' | translate}}</ng-template>

            <!-- *ngIf="stepNewRecord==2" -->
          <nb-card class="card1CreateNewClaimStep2">

            <!-- <nb-card-header style="width: 100%; text-align: center;">
              Додаткова інформація
            </nb-card-header> -->
      
            <nb-card-body>
              <form [formGroup]="formGroups" style="height: 75%;">
                <ng-container [ngTemplateOutlet]="this[part]"></ng-container>
      
                <ng-template #one>
                  <label class="label-question center">
                    {{'single_claim_component.text44' | translate}}
                  </label>
                  <nb-radio-group name="groupQuery1" formControlName="groupQuery1"
                                  class="input-radio" [(ngModel)]="radioGroupQueryValue1">
                    <nb-radio class="radioItem" [value]="valNo">{{valNo.text}}</nb-radio>
                    <nb-radio class="radioItem" [value]="valYes">{{valYes.text}}</nb-radio>
                  </nb-radio-group>
                </ng-template>
      
                <ng-template #two>
                  <label class="label-question center">
                    {{'single_claim_component.text45' | translate}}
                  </label>
                  <nb-radio-group name="groupQuery2" formControlName="groupQuery2"
                                  class="input-radio" [(ngModel)]="radioGroupQueryValue2">
                    <nb-radio class="radioItem" [value]="valNo">{{valNo.text}}</nb-radio>
                    <nb-radio class="radioItem" [value]="valYes2">{{valYes2.text}}</nb-radio>
                    <nb-radio class="radioItem" [value]="valYes3">{{valYes3.text}}</nb-radio>
                  </nb-radio-group>
                </ng-template>
      
                <ng-template #three>
                  <label class="label-question center">
                    {{'single_claim_component.text46' | translate}}
                  </label>
                  <nb-radio-group name="groupQuery3" formControlName="groupQuery3"
                                  class="input-radio" [(ngModel)]="radioGroupQueryValue3">
                    <nb-radio class="radioItem" [value]="valWhereCard">{{valWhereCard.text}}
                    </nb-radio>
                    <nb-radio class="radioItem" [value]="valWhereCard2">{{valWhereCard2.text}}
                    </nb-radio>
                  </nb-radio-group>
                </ng-template>
      
                <ng-template #four>
                  <label class="label-question center">
                    {{'single_claim_component.text47' | translate}}
                  </label>
                  <input class="control-input-questions" nbInput style="cursor: pointer;"
                          placeholder="{{'single_claim_component.text47' | translate}}"
                          [nbDatepicker]="formpicker"
                          [(ngModel)]="claimData.transDate"
                          formControlName="groupQuery4" required readonly>
                  <nb-datepicker #formpicker></nb-datepicker>
                </ng-template>
      
                <ng-template #five>
                  <label class="label-question center">
                    {{'single_claim_component.text48' | translate}}
                  </label>
                  <nb-radio-group name="groupQuery5" formControlName="groupQuery5"
                                  class="input-radio" [(ngModel)]="radioGroupQueryValue5">
                    <nb-radio class="radioItem" [value]="valNeedDocument">{{valNeedDocument.text}}
                    </nb-radio>
                    <nb-radio class="radioItem" [value]="valNeedDocument2">{{valNeedDocument2.text}}
                    </nb-radio>
                  </nb-radio-group>
                </ng-template>
      
                <ng-template #six>
                  <label class="label-question center">
                    {{'single_claim_component.text49' | translate}}
                  </label>
                  <nb-radio-group name="groupQuery6" formControlName="groupQuery6"
                                  class="input-radio" [(ngModel)]="radioGroupQueryValue6">
                    <nb-radio class="radioItem" [value]="valOperation">{{valOperation.text}}
                    </nb-radio>
                    <nb-radio class="radioItem" [value]="valOperation2">{{valOperation2.text}}
                    </nb-radio>
                  </nb-radio-group>
                </ng-template>
      
                <ng-template #seven>
                  <label class="label-question center">
                    {{'single_claim_component.text50' | translate}}
                  </label>
                  <nb-radio-group name="groupQuery7" formControlName="groupQuery7"
                                  class="input-radio" [(ngModel)]="radioGroupQueryValue7">
                    <nb-radio class="radioItem" [value]="valMoney">{{valMoney.text}}
                    </nb-radio>
                    <nb-radio class="radioItem" [value]="valMoney2">{{valMoney2.text}}
                    </nb-radio>
                  </nb-radio-group>
                </ng-template>
      
                <ng-template #eight>
                  <label class="label-question center">
                    {{'single_claim_component.text51' | translate}}
                  </label>
                  <nb-radio-group name="groupQuery8" formControlName="groupQuery8"
                                  class="input-radio" [(ngModel)]="radioGroupQueryValue8">
                    <nb-radio class="radioItem" [value]="valOll">{{valOll.text}}
                    </nb-radio>
                    <nb-radio class="radioItem" [value]="valOll2">{{valOll2.text}}
                    </nb-radio>
                  </nb-radio-group>
                </ng-template>
      
                <ng-template #nine>
                  <label class="label-question center">
                    {{'single_claim_component.text52' | translate}}
                  </label>
                  <input class="input-data" nbInput placeholder="{{'single_claim_component.text52' | translate}}"
                          name="groupQuery9" formControlName="groupQuery9"
                  >
                </ng-template>
      
                <ng-template #ten>
                  <label class="label-question center">
                    {{'single_claim_component.text53' | translate}}
                  </label>
                  <nb-radio-group name="groupQuery10" formControlName="groupQuery10"
                                  class="input-radio" [(ngModel)]="radioGroupQueryValue10">
                    <nb-radio class="radioItem" [value]="valWhereOperation">{{valWhereOperation.text}}
                    </nb-radio>
                    <nb-radio class="radioItem" [value]="valWhereOperation2">{{valWhereOperation2.text}}
                    </nb-radio>
                  </nb-radio-group>
                </ng-template>
      
                <ng-template #eleven>
                  <label class="label-question center">
                    {{'single_claim_component.text54' | translate}}
                  </label>
                  <nb-radio-group style="margin-bottom: 2em;" name="groupQuery11" formControlName="groupQuery11"
                                  class="input-radio" [(ngModel)]="radioGroupQueryValue11">
                    <nb-radio class="radioItem" [value]="valGet">{{valGet.text}}
                    </nb-radio>
                    <nb-radio class="radioItem" [value]="valGet2">{{valGet2.text}}
                    </nb-radio>
                  </nb-radio-group>
                  <nb-alert style="font-size: 12px;" outline="warning">{{'single_claim_component.text55' | translate}}</nb-alert>
                </ng-template>
      
                <ng-template #twelve>
                  <label class="label-question center">
                    {{'single_claim_component.text56' | translate}}
                  </label>
                    <div class="center_select">
                        <nb-select name="groupQuery12" formControlName="groupQuery12"
                            class="selector-list-questions" [(selected)]="question">
                            <nb-option style="font-size: 13px;" *ngFor="let item of listQuestions" [value]="item">
                                {{ item.caption }}
                            </nb-option>
                        </nb-select>
                    </div>
                </ng-template>
      
                <ng-template #thirteen>
                  <label class="label-question center">
                    {{'single_claim_component.text57' | translate}}
                  </label>
                  <nb-radio-group name="groupQuery13" formControlName="groupQuery13"
                                  class="input-radio" [(ngModel)]="radioGroupQueryValue13">
                    <nb-radio class="radioItem" [value]="valPay">{{valPay.text}}
                    </nb-radio>
                    <nb-radio class="radioItem" [value]="valPay2">{{valPay2.text}}
                    </nb-radio>
                  </nb-radio-group>
                </ng-template>
      
                <ng-template #fourteen>
                  <label class="label-question center">
                    {{'single_claim_component.text58' | translate}}
                  </label>
                  <input class="input-date" nbInput
                          placeholder="{{'single_claim_component.text58' | translate}}"
                          [nbDatepicker]="formpicker"
                          name="groupQuery14" formControlName="groupQuery14"
                          [(ngModel)]="claimData.trans_date" style="cursor: pointer;" required readonly>
                  <nb-datepicker #formpicker></nb-datepicker>
                </ng-template>
      
                <ng-template #fiveteen>
                  <label class="label-question center">
                    {{'single_claim_component.text59' | translate}}
                  </label>
                  <input class="input-date" nbInput
                          placeholder="{{'single_claim_component.text59' | translate}}"
                          [nbDatepicker]="formpicker"
                          name="groupQuery15" formControlName="groupQuery15"
                          [(ngModel)]="claimData.comments" style="cursor: pointer;" required readonly>
                  <nb-datepicker #formpicker></nb-datepicker>
                </ng-template>
      
                <ng-template #sixteen>
                  <label class="label-question center">
                    {{'single_claim_component.text60' | translate}}
                  </label>
                  <input class="control-input-questions" nbInput placeholder="{{'single_claim_component.text60' | translate}}"
                          name="groupQuery16" formControlName="groupQuery16">
                  <nb-select class="control-input-questions" [(selected)]="claimData.currency">
                    <nb-option style="font-size: 13px;" *ngFor="let item of listCurrency" [value]="item.id">
                      {{ item.caption }}
                    </nb-option>
                  </nb-select>
                </ng-template>
      
                <ng-template #seventeen>
                  <label class="label-question center">
                    {{'single_claim_component.text61' | translate}}
                  </label>
                  <nb-radio-group name="groupQuery17" formControlName="groupQuery17"
                                  class="input-radio" [(ngModel)]="radioGroupQueryValue15">
                    <nb-radio class="radioItem" [value]="valBack">{{valBack.text}}
                    </nb-radio>
                    <nb-radio class="radioItem" [value]="valBack2">{{valBack2.text}}
                    </nb-radio>
                  </nb-radio-group>
                </ng-template>
      
              </form>

              <nb-alert *ngIf="isGoToNextStep" accent="warning">{{'single_claim_component.text62' | translate}}</nb-alert>
            </nb-card-body>
      
            <nb-card-footer>
              <div class="center card1CreateNewClaimStep2Footer">
                  <button  nbButton nbStepperPrevious status="primary" size="small" (click)="onClickBack()">{{'single_claim_component.button9' | translate}}</button>
                  <button *ngIf="isVisibleBackStepButton" nbButton status="primary" size="small" style="margin-left: 10px;" (click)="onClickBackStep()">{{'single_claim_component.button10' | translate}}</button>
                  <button *ngIf="!isLastStep" nbButton status="primary" size="small" style="margin-left: 10px;" (click)="change(this)">{{'single_claim_component.button11' | translate}}</button>
                  <!-- <button *ngIf="isLastStep" nbButton status="primary" style="margin-left: 10px;" (click)="saveClaim()">Відправити</button> -->
                  <button *ngIf="isLastStep" nbButton size="small" nbStepperNext status="primary" 
                    [disabled]="!getCheckData"
                    style="margin-left: 10px;">{{'single_claim_component.button12' | translate}}</button>
              </div>
            </nb-card-footer>
          </nb-card>
      
        </nb-step>

        <nb-step [label]="labelThird">

          <ng-template #labelThird>{{'single_claim_component.text63' | translate}}</ng-template>

          <nb-card class="card1CreateNewClaimStep3">
            <nb-card-header style="text-align: center;">{{'single_claim_component.text64' | translate}}</nb-card-header>
            <nb-card-body>
              <div class="div-panel itemDisplayColumn" *ngIf="!fieldsStatus.comment.invisible">
                <label class="label-caption">{{'single_claim_component.text65' | translate}}</label>
                <textarea class="input-data" [required]="fieldsStatus.comment.required"
                [readonly]="fieldsStatus.comment.readonly" placeholder="{{'single_claim_component.text65' | translate}}" name="ch_comments"
                [(ngModel)]="claimData.ch_comments" rows="6" nbInput fullWidth></textarea>
                <!-- <input class="input-data" nbInput placeholder="Ваші коментарі" name="ch_comments" 
                  > -->
              </div>

              <div class="div-panel" *ngIf="!fieldsStatus.docs.invisible">
                <label class="label-caption">{{'single_claim_component.text66' | translate}}</label>
                <input #fileInput  name="file_upload"
                    [hidden]="true" placeholder="Додати файл" onclick="this.value=null"
                    type='file' (change)="fileChanged($event)">
                <nb-icon icon="attach-outline" (click)="fileInput.click()"></nb-icon>&nbsp;&nbsp;
                <div style="display: flex; flex-direction: column;">
                  <div *ngFor="let file of filesArr" class="fileAttached">
                      {{file.name}} <nb-icon icon="close-outline" (click)="deleteAttachedFile(file)"></nb-icon>
                  </div>
                </div>
              </div>

            </nb-card-body>

            <nb-card-footer>
              <div class="center">
                <button  nbButton nbStepperPrevious size="small" status="primary" >{{'single_claim_component.button13' | translate}}</button>
                <button *ngIf="isLastStep && getCheckData" [nbSpinner]="loadingCreateNewClaim" [disabled]="loadingCreateNewClaim"
                 nbSpinnerStatus="info" size="small" nbButton status="primary" style="margin-left: 10px;" (click)="saveClaim()">{{'single_claim_component.button14' | translate}}</button>
              </div>
            </nb-card-footer>

          </nb-card>
        </nb-step>

      </nb-stepper>

    </nb-card-body>
  </nb-card>

  </div>
